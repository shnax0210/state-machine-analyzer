<!DOCTYPE html>
<html>
<head>
    <title>State machine analyzer</title>
    <style>
        g.graph--node_red > rect {
            fill: #ff0000;
        }

        g.graph--node_cyan > rect {
            fill: #00FFFF;
        }

        g.graph--node_blue > rect {
            fill: #0000FF;
        }

        g.graph--node_purple > rect {
            fill: #800080;
        }

        g.graph--node_yellow > rect {
            fill: #FFFF00;
        }

        g.graph--node_lime > rect {
            fill: #00FF00;
        }

        g.graph--node_magenta > rect {
            fill: #FF00FF;
        }

        g.graph--node_white > rect {
            fill: #FFFFFF;
        }

        g.graph--node_silver > rect {
            fill: #C0C0C0;
        }

        g.graph--node_gray > rect {
            fill: #808080;
        }

        g.graph--node_black > rect {
            fill: #000000;
        }

        g.graph--node_orange > rect {
            fill: #FFA500;
        }

        g.graph--node_brown > rect {
            fill: #A52A2A;
        }

        g.graph--node_maroon > rect {
            fill: #800000;
        }

        g.graph--node_green > rect {
            fill: #008000;
        }

        g.graph--node_olive > rect {
            fill: #808000;
        }

        .marks-area__mark_red {
            color: #ff0000;
        }

        .marks-area__mark_cyan {
            color: #00FFFF;
        }

        .marks-area__mark_blue {
            color: #0000FF;
        }

        .marks-area__mark_purple {
            color: #800080;
        }

        .marks-area__mark_yellow {
            color: #FFFF00;
        }

        .marks-area__mark_lime {
            color: #00FF00;
        }

        .marks-area__mark_magenta {
            color: #FF00FF;
        }

        .marks-area__mark_silver {
            color: #C0C0C0;
        }

        .marks-area__mark_gray {
            color: #808080;
        }

        .marks-area__mark_black {
            color: #000000;
        }

        .marks-area__mark_orange {
            color: #FFA500;
        }

        .marks-area__mark_brown {
            color: #A52A2A;
        }

        .marks-area__mark_maroon {
            color: #800000;
        }

        .marks-area__mark_green {
            color: #008000;
        }

        .marks-area__mark_olive {
            color: #808000;
        }

        text {
            font-weight: 300;
            font-family: "Helvetica Neue", Helvetica, Arial, sans-serif;
            font-size: 14px;
        }

        .node rect {
            stroke: #999;
            fill: #fff;
            stroke-width: 1.5px;
        }

        .edgePath path {
            stroke: #333;
            stroke-width: 1.5px;
        }

        body {
            background-image: url('assets/pexels-miguel-19670.jpg');
            font-family: Garamond, serif;
        }
        
        .main-area {
            display: flex;
            flex-direction: column;
            width: 95%;
            margin: 0 auto;
        }
        
        .introduction-area {
            text-align: center;
        }
        
        .edit-area__editor {
            height: 350px;
        }
        
        .graph-area {
            border:2px solid #000;
            overflow: auto;
        }
        
        .graph-area__graph {

        }

        .graph-area__graph_small-screen {
            height: 500px;
            overflow: hidden;
        }

        .graph-area__graph_full-screen {
            height: 90vh;
            width: 95vw;
            overflow: hidden;
        }

        .graph-area__button {
            background-color: #008CBA;
            color: white;
            border: none;
            border-radius: 12px;
            height: 30px;
            margin: 5px 5px;
        }
        
        .edit-area__button {
            background-color: #008CBA;
            margin: 15px 0;
            height: 30px;
            width: 100%;
            color: white;
            border: none;
            border-radius: 12px;
        }
        
        .examples-area__list {
            display: flex;
            flex-wrap: wrap;
        }

        .examples-area__button {
            background-color: #008CBA;
            color: white;
            border: none;
            border-radius: 12px;
            height: 30px;
            margin: 0 15px;
        }

        .marks-area__list {
            display: flex;
            flex-wrap: wrap;
            justify-content: space-around;
        }

        .marks-area__mark {
            
        }
    </style>
</head>
<body>

<div class="main-area">
    <div class="introduction-area">
        <h1>State machine analyzer</h1>
    </div>
    <div class="examples-area">
        <h1>You can check next examples:</h1>
        <div class="examples-area__list"></div>
    </div>
    <div class="marks-area">
        <h1>You can use next marks to color your state machine:</h1>
        <div class="marks-area__list"></div>
    </div>
    <div class="edit-area">
        <h1>Please define your state machine here:</h1>
        <div id="editor" class="edit-area__editor"></div>
        <button class="edit-area__button">Build graph</button>
    </div>
    
    <div class="graph-area">
        <div class="graph-area__graph graph-area__graph_small-screen"></div>
        <button class="graph-area__button graph-area__full-screen-button">Full screen ON/OF</button>
    </div>
</div>

<script src="dest/js/bundle.js"></script>
<script src="lib/ace-builds-master/src-noconflict/ace.js" type="text/javascript" charset="utf-8"></script>
<script src="examples.js" type="text/javascript" charset="utf-8"></script>
<script src="marks.js" type="text/javascript" charset="utf-8"></script>
<script>
    const SAVED_CODE_VARIABLE_NAME = 'savedCode';
    
    function handleExamplesArea(editor) {
        function createButton(example) {
            let btn = document.createElement("button");
            btn.innerHTML = example.name;
            btn.className = "examples-area__button"
            btn.addEventListener("click", () => editor.setValue(example.code));
            return btn;
        }

        const examplesAreaElement = document.querySelector(".examples-area__list");
        EXAMPLES.forEach(example => examplesAreaElement.append(createButton(example)));
    }
    
    function handleMarks() {
        function createMark(mark) {
            let div = document.createElement("div");
            div.innerHTML = mark.label;
            div.className = "marks-area__mark marks-area__mark_" + mark.color;
            return div;
        }
        
        const marksAreaElement = document.querySelector(".marks-area__list");
        AVAILABLE_MARKS.forEach(mark => marksAreaElement.append(createMark(mark)));
    }
    
    function addCodeSaving(editor) {
        editor.getSession().on('change', () => window.localStorage.setItem(SAVED_CODE_VARIABLE_NAME, editor.getValue()));
        
        const savedCode = window.localStorage.getItem(SAVED_CODE_VARIABLE_NAME);
        if(savedCode) editor.setValue(savedCode);
    }
    
    function createEditor(elementId) {
        const editor = ace.edit(elementId);
        editor.setTheme("ace/theme/monokai");
        editor.session.setMode("ace/mode/javascript");

        addCodeSaving(editor);

        return editor;
    }
    
    function addHandlerForResizeButton() {
        function toggleGraphScreenView(graphElement, classToRemove, classToAdd, otherElementsDisplay) {
            document.querySelectorAll(".main-area > *").forEach(element => element.style.display = otherElementsDisplay);
            graphElement.classList.remove(classToRemove);
            graphElement.classList.add(classToAdd);
            document.querySelector(".graph-area").style.display = "block";
            window.scrollTo(0,document.body.scrollHeight);
        }
        
        document.querySelector(".graph-area__full-screen-button").addEventListener("click", () => {
            const graphElement = document.querySelector(".graph-area__graph");
            if(graphElement.classList.contains("graph-area__graph_small-screen")) {
                toggleGraphScreenView(graphElement, "graph-area__graph_small-screen", "graph-area__graph_full-screen", "none");
                return;
            }

            if(graphElement.classList.contains("graph-area__graph_full-screen")) {
                toggleGraphScreenView(graphElement, "graph-area__graph_full-screen", "graph-area__graph_small-screen", "block");
                return;
            }

            throw "Not possible graph element classes state";
        });
    }
    
    function addHandlerForBuildGraphButton(editor) {
        document.querySelector(".edit-area__button").addEventListener("click", () => {
            const stateMachineDefinition = new Function(editor.getValue())();
            stateMachineDefinition.marks = AVAILABLE_MARKS;

            function decorateMarkState(markState) {
                if(!markState) {
                    return () => DEFAULT_MARK;
                }

                return state => markState(state) || DEFAULT_MARK;
            }

            stateMachineDefinition.markState = decorateMarkState(stateMachineDefinition.markState)

            if(!stateMachineDefinition.marksThatEventsWillBeAppliedTo) {
                stateMachineDefinition.marksThatEventsWillBeAppliedTo = AVAILABLE_MARKS.map(mark => mark.label);
            }

            const stateMachine = createStateMachine(stateMachineDefinition);
            stateMachine.render(".graph-area__graph");
        });
    }

    const editor = createEditor("editor");
    handleExamplesArea(editor);
    handleMarks();

    addHandlerForResizeButton();
    addHandlerForBuildGraphButton(editor);
</script>
</body>
</html>
